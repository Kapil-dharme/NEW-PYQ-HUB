<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Browse Papers - PYQ Hub</title>
    <%- include("./partials/head") %>
        <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-50 flex flex-col min-h-screen">

    <%- include("./partials/navbar") %>
    <%- include("./partials/loader") %>
    <%- include("./partials/error") %>
    <%- include("./partials/success") %>

                    <div id="mainContent" class="container mx-auto px-4 py-8 transition-all duration-500 relative z-10">

                        <div class="flex justify-between items-center mb-8 ">
                            <div class="<%= locals.admin ? 'flex-1 text-center' : '' %>">
                                <% if (locals.admin) { %>
                                    <h2
                                        class="text-4xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-rose-500 via-purple-500 to-emerald-500">
                                        Admin Dashboard
                                    </h2>
                                    <p class="text-gray-600 mt-2 font-medium">âœ¨ Manage all papers</p>
                                    <% } else { %>
                                        <h2 class="text-3xl font-bold text-gray-900 tracking-tight">
                                           <%= branch=='na' ? 'Year' : 'Branch'%> :- <span class="text-indigo-600">
                                                <%= branch=='na' ? 'First Year (FY)' : branch%>
                                            </span>
                                        </h2>
                                        <p class="text-gray-600 mt-1 font-medium">Showing papers for your selection</p>
                                        <% } %>
                            </div>
                            <div class="p-6 pb-0">
                                <% if (locals.admin) { %>
                                    <a href="/user/browse"
                                        class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition flex items-center gap-2 shadow-md">
                                        Filter
                                    </a>
                                    <% } else { %>
                                        <a href="/user/browse"
                                            class="inline-flex items-center gap-2 px-4 py-2 border-2 border-gray-300 hover:border-indigo-500 text-gray-700 hover:text-indigo-600 font-semibold rounded-lg transition-all group">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18"
                                                fill="currentColor"
                                                class="transition-transform group-hover:-translate-x-1"
                                                viewBox="0 0 16 16">
                                                <path fill-rule="evenodd"
                                                    d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8" />
                                            </svg>
                                            Back
                                        </a>
                                        <% } %>

                            </div>
                        </div>
                        <% if (papers.length===0) { %>

                            <div
                                class="fixed inset-0 bg-black/30 backdrop-blur-sm flex items-center justify-center z-50">


                                <div
                                    class="bg-white/90 backdrop-blur-md rounded-xl px-8 py-8 text-center w-80 shadow-xl border border-gray-100">


                                    <div
                                        class="w-12 h-12 bg-indigo-50 rounded-full flex items-center justify-center mx-auto mb-4">
                                        <svg class="w-6 h-6 text-indigo-400" fill="none" stroke="currentColor"
                                            stroke-width="1.5" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round"
                                                d="M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z" />
                                        </svg>
                                    </div>

                                    <!-- Title -->
                                    <h2 class="text-base font-semibold text-gray-800 mb-1 text-center tracking-wide">
                                        ðŸ˜” No Papers Yet
                                    </h2>

                                    <% if (locals.admin) { %>
                                        <p class="text-gray-400 text-xs leading-relaxed mb-6">
                                            Your paper list is empty. <br /> Add your first paper to get started.
                                        </p>

                                        <!-- Button -->
                                        <a href="/admin/add-paper"
                                            class="inline-flex items-center gap-1.5 bg-indigo-600 hover:bg-indigo-700 text-white text-xs font-medium px-4 py-2 rounded-lg transition-colors duration-200 shadow-sm">
                                            <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" stroke-width="2"
                                                viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round"
                                                    d="M12 4.5v15m7.5-7.5h-15" />
                                            </svg>
                                            Add Paper
                                        </a>
                                        <% } else { %>
                                            <p class="text-gray-500 text-sm text-center font-medium mt-4">
                                                Sorry, no papers found for this search yet!
                                            </p>
                                            <% } %>



                                </div>
                            </div>
                            <% } %>

                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">

                                    <% papers.forEach(paper=> { %>

                                        <div
                                            class="bg-white p-6 rounded-xl shadow-sm border border-gray-100 hover:shadow-md transition flex flex-col relative group">

                                            <% if (locals.admin) { %>
                                                <button
                                                    onclick="openDeleteModal('/admin/delete-paper/<%= paper._id %>')"
                                                    class="admin-delete-btn hidden absolute top-3 right-3 bg-white text-red-500 hover:bg-red-50 hover:text-red-700 p-2 rounded-full transition-all shadow-sm border border-red-100 z-20"
                                                    title="Delete Paper">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                                        fill="currentColor" class="bi bi-trash" viewBox="0 0 16 16">
                                                        <path
                                                            d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z" />
                                                        <path
                                                            d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z" />
                                                    </svg>
                                                </button>
                                                <% } %>

                                                    <div class="flex justify-between items-start mb-4 pr-10">
                                                        <div class="p-3 bg-red-50 text-red-600 rounded-lg">
                                                            <svg xmlns="http://www.w3.org/2000/svg" width="25"
                                                                height="25" fill="currentColor"
                                                                class="bi bi-filetype-pdf" viewBox="0 0 16 16">
                                                                <path fill-rule="evenodd"
                                                                    d="M14 4.5V14a2 2 0 0 1-2 2h-1v-1h1a1 1 0 0 0 1-1V4.5h-2A1.5 1.5 0 0 1 9.5 3V1H4a1 1 0 0 0-1 1v9H2V2a2 2 0 0 1 2-2h5.5zM1.6 11.85H0v3.999h.791v-1.342h.803q.43 0 .732-.173.305-.175.463-.474a1.4 1.4 0 0 0 .161-.677q0-.375-.158-.677a1.2 1.2 0 0 0-.46-.477q-.3-.18-.732-.179m.545 1.333a.8.8 0 0 1-.085.38.57.57 0 0 1-.238.241.8.8 0 0 1-.375.082H.788V12.48h.66q.327 0 .512.181.185.183.185.522m1.217-1.333v3.999h1.46q.602 0 .998-.237a1.45 1.45 0 0 0 .595-.689q.196-.45.196-1.084 0-.63-.196-1.075a1.43 1.43 0 0 0-.589-.68q-.396-.234-1.005-.234zm.791.645h.563q.371 0 .609.152a.9.9 0 0 1 .354.454q.118.302.118.753a2.3 2.3 0 0 1-.068.592 1.1 1.1 0 0 1-.196.422.8.8 0 0 1-.334.252 1.3 1.3 0 0 1-.483.082h-.563zm3.743 1.763v1.591h-.79V11.85h2.548v.653H7.896v1.117h1.606v.638z" />
                                                            </svg>
                                                        </div>
                                                        <% if (paper.examtype=='endsem' ) { %>
                                                            <span
                                                                class="px-3 py-1 text-xs font-bold bg-gradient-to-r from-indigo-400 to-purple-500 text-white rounded-full whitespace-nowrap uppercase">
                                                                <%= paper.examtype %>
                                                            </span>
                                                            <% } else { %>

                                                                <span
                                                                    class="px-3 py-1 text-xs font-bold bg-gradient-to-r from-amber-500 to-amber-600 text-white rounded-full whitespace-nowrap uppercase">
                                                                    <%= paper.examtype %>
                                                                </span>
                                                                <% } %>
                                                    </div>

                                                    <h3
                                                        class="text-sm font-black uppercase tracking-[0.2em] text-gray-800 mb-3 pb-2 border-b border-dashed border-gray-200 relative">
                                                        <span
                                                            class="bg-gradient-to-r from-indigo-600 to-purple-600 text-transparent bg-clip-text">
                                                            Subject : <%= paper.subject %>
                                                        </span>
                                                    </h3>

                                                    <div class="flex justify-between items-center mb-6">
                                                        <span
                                                            class="text-xs font-semibold uppercase tracking-widest text-indigo-400">
                                                            ðŸ“… Year &nbsp;: <span
                                                                class="text-indigo-600 bg-indigo-50 px-2 py-0.5 rounded-md font-bold">
                                                                <%= ({ '1' : 'First Year' , '2' : 'Second Year' , '3'
                                                                    : 'Third Year' , '4' : 'Final Year' })[paper.year]
                                                                    || paper.year %>
                                                            </span>
                                                        </span>
                                                        <span
                                                            class="text-xs font-semibold text-purple-500 bg-purple-50 px-2 py-0.5 rounded-md">
                                                            Branch : <%= ({ cse: 'CSE' , it: 'IT' , entc: 'ENTC' ,
                                                                electrical: 'Electrical' , mechanical: 'Mechanical' ,
                                                                civil: 'Civil' , instrumentation: 'Instrumentation' ,
                                                                na: 'N/A' })[paper.branch] || paper.branch %>
                                                        </span>
                                                    </div>
                                                    <a href="<%= paper.fileUrl %>"
                                                        class="mt-auto w-full bg-indigo-50 border border-indigo-100 text-indigo-700 py-2.5 rounded-lg hover:bg-indigo-600 hover:text-white transition font-semibold flex justify-center items-center gap-2 group-btn">
                                                        View Paper
                                                    </a>
                                        </div>
                                        <% }) %>
                                </div>
                    </div>
                    <!-- Delete Confirmation Modal -->
                    <div id="deleteModal"
                        class="fixed inset-0 z-50 flex items-center justify-center opacity-0 pointer-events-none transition-opacity duration-300">
                        <!-- Backdrop with blur -->
                        <div class="absolute inset-0 bg-black bg-opacity-50 backdrop-blur-sm"></div>

                        <!-- Modal -->
                        <div class="relative bg-white rounded-2xl shadow-2xl w-full max-w-sm mx-4 transform transition-all duration-300 scale-95"
                            id="deleteModalContent">

                            <!-- Header -->
                            <div
                                class="flex items-center justify-between px-6 py-4 bg-gray-50 rounded-t-2xl border-b border-gray-200">
                                <h5 class="text-base font-bold text-gray-900">Confirm Delete</h5>
                                <button onclick="closeDeleteModal()"
                                    class="text-gray-400 hover:text-gray-600 transition text-2xl leading-none">&times;</button>
                            </div>

                            <!-- Body -->
                            <div class="px-6 py-6 text-center">
                                <p class="text-gray-600 mb-1">Are you sure you want to delete this paper?</p>
                                <small class="text-gray-400 text-sm">This action cannot be undone.</small>
                            </div>

                            <!-- Footer -->
                            <div class="flex items-center justify-center gap-3 px-6 py-4 border-t border-gray-200">
                                <button onclick="closeDeleteModal()"
                                    class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition font-semibold text-sm">
                                    Cancel
                                </button>

                                <form id="deleteForm" method="POST">
                                    <button type="button" onclick="confirmDelete()"
                                        class="px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition font-semibold text-sm">
                                        Delete
                                    </button>
                                </form>
                            </div>

                        </div>
                    </div>

                    <script>
                        function openDeleteModal(deleteUrl) {
                            const modal = document.getElementById('deleteModal');
                            const modalContent = document.getElementById('deleteModalContent');

                            document.getElementById('deleteForm').action = deleteUrl;

                            modal.classList.remove('opacity-0', 'pointer-events-none');
                            modal.classList.add('opacity-100');
                            modalContent.classList.remove('scale-95');
                            modalContent.classList.add('scale-100');
                        }

                        function closeDeleteModal() {
                            const modal = document.getElementById('deleteModal');
                            const modalContent = document.getElementById('deleteModalContent');

                            modal.classList.remove('opacity-100');
                            modal.classList.add('opacity-0', 'pointer-events-none');
                            modalContent.classList.remove('scale-100');
                            modalContent.classList.add('scale-95');
                        }

                        function confirmDelete() {
                            closeDeleteModal();
                            setTimeout(() => {  
                                showLoader();
                                document.getElementById('deleteForm').submit();
                            }, 300);
                        }

                        // Close modal when clicking backdrop
                        document.getElementById('deleteModal').addEventListener('click', function (e) {
                            if (e.target === this) {
                                closeDeleteModal();
                            }
                        });
                    </script>

                    <script>
                        /////////////////////////////////
                        const isAdmin = true;
                        ///////////////////////

                        function openModal() {
                            const modal = document.getElementById('popupModal');
                            const mainContent = document.getElementById('mainContent');

                            modal.classList.remove('opacity-0', 'pointer-events-none');
                            mainContent.classList.add('blur-sm', 'pointer-events-none');
                        }


                        if (isAdmin) {
                            document.querySelectorAll('.admin-delete-btn').forEach(btn => {
                                btn.classList.remove('hidden');
                            });
                        }
                    </script>
                    <%- include("./partials/footer") %>

</body>

</html>